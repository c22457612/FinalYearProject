<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VPT Control Centre — Site Insights</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body class="site-page">
  <header class="site-header">
    <div class="site-header-left">
      <a class="back-link" href="/">← Back to Control Centre</a>
      <h1 id="siteTitle">Site insights</h1>
      <div id="siteSubtitle" class="site-subtitle">Loading…</div>
    </div>

    <div class="site-header-right">
      <span id="siteConnectionStatus" class="badge">Connecting…</span>
      <div class="site-actions">
        <button id="exportSiteCsvBtn" class="btn-export" disabled>Download CSV</button>
        <button id="exportSiteJsonBtn" class="btn-export" disabled>Download JSON</button>
      </div>
    </div>
  </header>

  <div class="site-content">
    <!-- Summary cards -->
    <section class="summary site-summary">
      <div class="summary-card">
        <h2>Total events</h2>
        <div id="siteStatTotal" class="value">0</div>
        <div class="hint">stored in SQLite</div>
      </div>

      <div class="summary-card">
        <h2>Blocked</h2>
        <div id="siteStatBlocked" class="value">0</div>
        <div class="hint">network.blocked</div>
      </div>

      <div class="summary-card">
        <h2>Observed</h2>
        <div id="siteStatObserved" class="value">0</div>
        <div class="hint">network.observed</div>
      </div>

      <div class="summary-card">
        <h2>Unique 3rd parties</h2>
        <div id="siteStatUniqueThird" class="value">0</div>
        <div class="hint">domains detected</div>
      </div>
    </section>

    <!-- Main grid -->
    <section class="site-grid">
      <!-- Big visualisation panel -->
      <div class="panel site-viz-panel">
        <div class="panel-header">
          <div>
            <div id="vizTitle" class="panel-title">Visualisation</div>
            <div class="panel-subtitle">Auto-updates as new events arrive</div>
          </div>

          <div class="viz-controls">
            <button id="vizPrevBtn" class="viz-nav" title="Previous">←</button>
            <button id="vizNextBtn" class="viz-nav" title="Next">→</button>

            <label class="viz-label" for="vizSelect">Mode</label>
            <select id="vizSelect" class="viz-select">
              <option value="timeline">Activity timeline (last 24h)</option>
              <option value="topSeen">Top third-party domains (seen)</option>
              <option value="kinds">Event breakdown (kind)</option>
              <option value="apiGating">3P API-like calls (heuristic)</option>
            </select>

            <label class="viz-label" for="rangeSelect">Range</label>
            <select id="rangeSelect" class="viz-select">
              <option value="24h" selected>Last 24h</option>
              <option value="1h">Last 1h</option>
              <option value="7d">Last 7d</option>
              <option value="all">All time</option>
            </select>
          </div>


        <div class="viz-wrap">
          <div id="vizChart" class="viz-chart"></div>
        </div>
      </div>

      <!-- Right detail column -->
      <div class="site-right">
        <div class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">Top third-party domains</div>
              <div class="panel-subtitle">Latest tracker activity on this site</div>
            </div>
          </div>

          <div class="scroll">
            <table>
              <thead>
                <tr>
                  <th>Domain</th>
                  <th>Seen</th>
                  <th>Blocked</th>
                  <th>Observed</th>
                </tr>
              </thead>
              <tbody id="topThirdBody">
                <tr><td colspan="4" class="muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div>
              <div class="panel-title">Recent events</div>
              <div class="panel-subtitle">Last 100 events for this site</div>
            </div>
          </div>

          <div class="scroll">
            <table>
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Kind</th>
                  <th>Domain</th>
                  <th>Mode</th>
                </tr>
              </thead>
              <tbody id="recentEventsBody">
                <tr><td colspan="4" class="muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="vizDrawerBackdrop" class="drawer-backdrop hidden"></div>

  <aside id="vizDrawer" class="drawer hidden">
    <div class="drawer-header">
      <div id="drawerTitle" class="drawer-title">Selection</div>
      <button id="drawerCloseBtn" class="drawer-close">×</button>
    </div>

    <div class="drawer-body">
      <div class="drawer-toggle">
        <button id="drawerNormalBtn" class="drawer-tab active">Normal</button>
        <button id="drawerAdvancedBtn" class="drawer-tab">Advanced</button>
      </div>

      <div id="drawerSummary" class="drawer-summary"></div>
      <div id="drawerEvents" class="drawer-events"></div>
    </div>
  </aside>


  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script src="site.js"></script>
</body>
</html>
